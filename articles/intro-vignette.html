<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CombineDistributions">
<title>Introduction to CombineDistributions • CombineDistributions</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to CombineDistributions">
<meta property="og:description" content="CombineDistributions">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CombineDistributions</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro-vignette.html">Introduction to CombineDistributions</a>
    <a class="dropdown-item" href="../articles/SIRS-vignette.html">Aggregating predictions from an SIRS model</a>
    <a class="dropdown-item" href="../articles/MMODS-vignette.html">Aggregation and trimming on real-world COVID-19 death predictions</a>
    <a class="dropdown-item" href="../articles/tidy-tuesday-example-analysis.html">Example Analysis</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to CombineDistributions</h1>
            
      
      
      <div class="d-none name"><code>intro-vignette.Rmd</code></div>
    </div>

    
    
<p>This package implements multiple methods for aggregating
probabilistic predictions, including probability and quantile averaging,
i.e., Linear Opinion Pool (LOP) (Stone 1961) and Vincent average <span class="citation">(Vincent 1912; Ratcliff 1979)</span> respectively. In
addition, this package implements non-equal weighting schemes, including
trimming methods <span class="citation">(Jose, Grushka-Cockayne, and
Lichtendahl 2014)</span> - see weighted aggregates vignette. Additional
information on these methods can be found in <span class="citation">(Howerton et al., n.d.)</span>.</p>
<div class="section level2">
<h2 id="unweighted-aggregation">Unweighted aggregation<a class="anchor" aria-label="anchor" href="#unweighted-aggregation"></a>
</h2>
<p>When aggregating probabilistic predictions, we can perform operations
on the probabilities or the quantiles. Here, we focus on averages (i.e.,
probability averaging or Linear Opinion Pool, and quantile averaging or
Vincent average).</p>
<p>If we consider a set of probabilistic predictions, each represented
by a cumulative distribution function (CDF), <span class="math inline">\(F_i(x)\)</span> where <span class="math inline">\(x\)</span> is the possible future outcome and
<span class="math inline">\(F_i(x)\)</span> is the probability that the
outcome is less than or equal to <span class="math inline">\(x\)</span>.
Then, define the quantile function, <span class="math inline">\(F_i^{-1}(\theta)\)</span> for some quantile <span class="math inline">\(\theta\)</span>.</p>
<p>To aggregate using the LOP method, we compute the arithmetic mean of
cumulative probabilities at each <span class="math inline">\(x\)</span>
value, or</p>
<p><span class="math display">\[
F_{LOP}(x) = \sum_{i = 1}^{N}w_iF_i(x)
\]</span> for <span class="math inline">\(N\)</span> models and weights
<span class="math inline">\(w_i\)</span>.</p>
<p>Conversely, for the Vincent average, we calculate the arithmetic mean
of values, <span class="math inline">\(x\)</span>, at each quantile
<span class="math inline">\(\theta\)</span>, or</p>
<p><span class="math display">\[
F_{V}(\theta) = \sum_{i = 1}^{N}w_iF_i^{-1}(\theta)
\]</span></p>
<p>also for <span class="math inline">\(N\)</span> models and weights
<span class="math inline">\(w_i\)</span>.</p>
<div class="section level3">
<h3 id="a-simple-example">A simple example<a class="anchor" aria-label="anchor" href="#a-simple-example"></a>
</h3>
<p>Below, we show how to implement these two methods using
<code>CombineDistributions</code> for a simple example using normal
distributions. First, let’s load the packages we will need.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for aggregation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://m-qin.github.io/CombineDistributions/" class="external-link">CombineDistributions</a></span><span class="op">)</span> </span>
<span><span class="co"># for data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> </span>
<span><span class="co"># for plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span></code></pre></div>
<p>Specifically, for this example we will aggregate two normal
distributions, <span class="math inline">\(N(\mu = 100, \sigma =
10)\)</span> and <span class="math inline">\(N(\mu = 120, \sigma =
5)\)</span>. Let’s define these two distributions at particular values,
<code>x</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set range of x values over which to define cdfs</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">80</span><span class="op">:</span><span class="fl">140</span></span>
<span></span>
<span><span class="co"># set CDFs</span></span>
<span><span class="va">mean1</span> <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="va">sig1</span> <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="va">pred1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">x</span>, </span>
<span>                     quantile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">mean1</span>, <span class="va">sig1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mean2</span> <span class="op">=</span> <span class="fl">120</span></span>
<span><span class="va">sig2</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="va">pred2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">x</span>, </span>
<span>                     quantile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">mean2</span>, <span class="va">sig2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can aggregate these distributions using the
<code><a href="../reference/aggregate_cdfs.html">aggregate_cdfs()</a></code> function. This function requires all
distributions be included in a single <code>data.frame</code> object
with columns <code>quantile</code> and <code>value</code> (to define
each CDF) and some column to distinguish between predictions.</p>
<p>So let’s put both predictions into a single <code>data.frame</code>
and add an <code>id</code> column.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">pred1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>, </span>
<span>                   <span class="va">pred2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s aggregate using LOP. We do this by setting
<code>method = "LOP"</code> in the function call. We also have to define
the quantiles over which we would like the aggregate CDF to be
returned.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.99</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">LOP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_cdfs.html">aggregate_cdfs</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">preds</span>, <span class="co"># predictions</span></span>
<span>               id_var <span class="op">=</span> <span class="st">"id"</span>,       <span class="co"># prediction identifier</span></span>
<span>               method <span class="op">=</span> <span class="st">"LOP"</span>,      <span class="co"># aggregation method</span></span>
<span>               ret_quantiles <span class="op">=</span> <span class="va">rq</span>   <span class="co"># quantiles to return</span></span>
<span>               <span class="op">)</span></span></code></pre></div>
<p>We can also aggregate using the Vincent average.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_cdfs.html">aggregate_cdfs</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">preds</span>, <span class="co"># predictions</span></span>
<span>               id_var <span class="op">=</span> <span class="st">"id"</span>,       <span class="co"># prediction identifier</span></span>
<span>               method <span class="op">=</span> <span class="st">"vincent"</span>,  <span class="co"># aggregation method</span></span>
<span>               ret_quantiles <span class="op">=</span> <span class="va">rq</span>   <span class="co"># quantiles to return</span></span>
<span>               <span class="op">)</span></span></code></pre></div>
<p>Now, let’s plot the individual (black) and aggregate predictions as
cumulative distribution functions (CDFs).</p>
<p><img src="intro-vignette_files/figure-html/plot-cdfs-1.png" width="672"></p>
<p>Next we’ll plot the probability density functions (PDFs), <span class="math inline">\(f_i(x)\)</span> to highlight the difference
between the two approaches. Because our predictions are defined as CDFs,
we will use a few tricks to obtain the PDFs.</p>
<ol style="list-style-type: decimal">
<li><p>The LOP operation defined above (operating on CDFs) is equivalent
to operating on PDFs, so <span class="math inline">\(f_{LOP}(x) =
\sum_{i = 1}^Nw_if_i(x)\)</span>.</p></li>
<li><p>The Vincent average of distributions from the same location-scale
family (i.e., defined with location and scale paramter) will also be
from that location-scale family, and the parameters of the aggregate are
the average of those from the individual distributions <span class="citation">(Thomas and Ross 1980)</span>. This property applies to
our case, because we are aggregating normal distributions. So, the
Vincent average aggregate will be a normal distribution with <span class="math inline">\(\mu_V = mean(\mu_1, \mu_2)\)</span> and <span class="math inline">\(\sigma_v = mean(\sigma_1,
\sigma_2)\)</span>.</p></li>
</ol>
<p>Let’s implement these operations to plot the PDFs. First, we define
the equivalent individual PDFs.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set PDFs</span></span>
<span><span class="va">mean1</span> <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="va">sig1</span> <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="va">pred1_pdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">x</span>, </span>
<span>                        prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">mean1</span>, <span class="va">sig1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mean2</span> <span class="op">=</span> <span class="fl">120</span></span>
<span><span class="va">sig2</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="va">pred2_pdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">x</span>, </span>
<span>                        prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">mean2</span>, <span class="va">sig2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine into single data.frame</span></span>
<span><span class="va">preds_pdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">pred1_pdf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>, </span>
<span>                       <span class="va">pred2_pdf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s implement the above rule to find the PDF of the LOP and
Vincent average aggregates.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LOP_pdf</span> <span class="op">&lt;-</span> <span class="va">preds_pdf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vin_pdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">x</span>, </span>
<span>                      prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mean1</span>, <span class="va">mean2</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sig1</span>, <span class="va">sig2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Plotting the results demonstrates the difference between the two
methods: the LOP treats individual predictions as alternate
possibilities, and retains the uncertainty captured between these
individual predictions, whereas the Vincent average treats individual
predictions as noisy samples and averages away the uncertainty captured
between the predictions.</p>
<p><img src="intro-vignette_files/figure-html/plot-pdfs-1.png" width="480"></p>
<p>In cases where these rules do not apply, we can obtain aggregate PDFs
by sampling from the aggregate CDF. See the SIRS vignette for an
example.</p>
</div>
<div class="section level3">
<h3 id="aggregating-across-multiple-groups">Aggregating across multiple groups<a class="anchor" aria-label="anchor" href="#aggregating-across-multiple-groups"></a>
</h3>
<p>Let’s say there are also death predictions for each model. To
illustrate, we add some simple death predictions to our existing
<code>data.frame</code> of case predictions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># take the predictions from the first example and specify they are  </span></span>
<span><span class="co"># predictions of incident cases</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="va">preds</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>target <span class="op">=</span> <span class="st">"incident cases"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define predictions of incident deaths for A and B and add to preds data.frame</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="va">preds</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span>, <span class="fl">0.1</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>               quantile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span>, <span class="fl">0.1</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span>, <span class="fl">0.1</span><span class="op">)</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, </span>
<span>               id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>               target <span class="op">=</span> <span class="st">"incident deaths"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>To aggregate both sets of predictions at the same time, we use the
<code>group_by</code> argument, where we provide a vector of column
names that provide additional strata/groupings. Then, one aggregate
distribution will be returned for each unique combination of the
<code>group_by</code> elements.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># aggregate case and death targets separately</span></span>
<span><span class="va">aggs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_cdfs.html">aggregate_cdfs</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">preds</span>,            <span class="co"># predictions</span></span>
<span>                       id_var <span class="op">=</span> <span class="st">"id"</span>,           <span class="co"># prediction identifier</span></span>
<span>                       group_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"target"</span><span class="op">)</span>,  <span class="co"># column names that specify groups</span></span>
<span>                       method <span class="op">=</span> <span class="st">"LOP"</span>,          <span class="co"># aggregation method</span></span>
<span>                       ret_quantiles <span class="op">=</span> <span class="va">rq</span>       <span class="co"># quantiles to return</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># aggs object has both incident cases and deaths</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">aggs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">quantile</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;             target quantile     value</span></span>
<span><span class="co">#&gt; 1:  incident cases     0.01 80.000000</span></span>
<span><span class="co">#&gt; 2: incident deaths     0.01  5.204324</span></span>
<span><span class="co">#&gt; 3:  incident cases     0.02 82.471293</span></span>
<span><span class="co">#&gt; 4: incident deaths     0.02  5.869789</span></span>
<span><span class="co">#&gt; 5:  incident cases     0.03 84.433107</span></span>
<span><span class="co">#&gt; 6: incident deaths     0.03  6.284290</span></span></code></pre></div>
<p>We can plot these two aggregates to see the full distribution.</p>
<p><img src="intro-vignette_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="implementation-details">Implementation details<a class="anchor" aria-label="anchor" href="#implementation-details"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<p><em>CDF checks:</em> The <code>CombineDistributions</code>
package implements two checks on all distributions to be aggregated.</p>
<ul>
<li><p>monotonic CDFs: for a set of increasing quantiles, <span class="math inline">\(q_i\)</span>, check that the values are also
increasing monotonically, i.e., <span class="math inline">\(F(q_i) \leq
F(q_{i+1})\)</span>.</p></li>
<li><p>NA values: check that no quantile or value is NA.</p></li>
</ul>
<p>If a CDF fails either check, it will be excluded from aggregation and
a warning message will be displayed.</p>
</li>
<li>
<p><em>Defining a CDF:</em> This package assumes that CDFs for each
individual prediction are defined as a set of value-quantile pairs.
Therefore, a method is needed to interpolate quantiles or values between
defined pairs and, in some cases, extrapolate beyond the set of
value-quantile pairs.</p>
<ul>
<li><p>For this package, we use linear interpolation
(<code><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx()</a></code>). The limitations of this choice are more
significant when the CDF is defined over fewer value-quantile
pairs.</p></li>
<li><p>We assume the CDF jumps to 0 and 1 outside the smallest and
largest value-quantile pairs. Because we do not attempt to estimate tail
probabilities, it is recommended that tail probabilities of the
individual distribution are sufficiently well defined (espeically when
those probabilities are of interest in the aggregate).</p></li>
</ul>
<p>Below is an example of a set of value-quantile pairs and the
corresponding piecewise-linear approximation with jumps that would be
aggregated by <code>CombineDistributions</code>.</p>
</li>
</ol>
<p><img src="intro-vignette_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-EAH-ms" class="csl-entry">
Howerton, Emily, Michael C. Runge, Tiffany L. Bogich, Rebecca K.
Borchering, Hidetoshi Inamine, Justin Lessler, Luke C. Mullany, et al.
n.d. <span>“Context-Dependent Representation of Within- and
Between-Model Uncertainty: Aggregating Probabilistic Predictions in
Infectious Disease Epidemiology.”</span> <em>In Prep</em>.
</div>
<div id="ref-jose_trimmed_2014" class="csl-entry">
Jose, Victor Richmond R., Yael Grushka-Cockayne, and Kenneth C.
Lichtendahl. 2014. <span>“Trimmed <span>Opinion Pools</span> and the
<span>Crowd</span>’s <span>Calibration Problem</span>.”</span>
<em>Management Science</em> 60 (2): 463–75.
</div>
<div id="ref-ratcliff_group_1979" class="csl-entry">
Ratcliff, Roger. 1979. <span>“Group Reaction Time Distributions and an
Analysis of Distribution Statistics.”</span> <em>Psychological
Bulletin</em> 86 (3): 446–61. https://doi.org/<a href="http://dx.doi.org.ezaccess.libraries.psu.edu/10.1037/0033-2909.86.3.446" class="external-link">http://dx.doi.org.ezaccess.libraries.psu.edu/10.1037/0033-2909.86.3.446</a>.
</div>
<div id="ref-thomas_appropriate_1980" class="csl-entry">
Thomas, Eward A. C., and Brian H. Ross. 1980. <span>“On Appropriate
Procedures for Combining Probability Distributions Within the Same
Family.”</span> <em>Journal of Mathematical Psychology</em> 21 (2):
136–52. <a href="https://doi.org/10.1016/0022-2496(80)90003-6" class="external-link">https://doi.org/10.1016/0022-2496(80)90003-6</a>.
</div>
<div id="ref-vincent_function_1912" class="csl-entry">
Vincent, Stella Burnham. 1912. <span>“The Function of the Vibrissae in
the Behavior of the White Rat.”</span> PhD thesis, <span>Cambridge
[Mass.</span>: Holt.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Emily Howerton.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
