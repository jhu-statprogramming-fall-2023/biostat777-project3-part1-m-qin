<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CombineDistributions">
<title>Aggregation and trimming on real-world COVID-19 death predictions • CombineDistributions</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Aggregation and trimming on real-world COVID-19 death predictions">
<meta property="og:description" content="CombineDistributions">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CombineDistributions</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro-vignette.html">Introduction to CombineDistributions</a>
    <a class="dropdown-item" href="../articles/SIRS-vignette.html">Aggregating predictions from an SIRS model</a>
    <a class="dropdown-item" href="../articles/MMODS-vignette.html">Aggregation and trimming on real-world COVID-19 death predictions</a>
    <a class="dropdown-item" href="../articles/tidy-tuesday-example-analysis.html">Example Analysis</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Aggregation and trimming on real-world COVID-19 death predictions</h1>
            
      
      
      <div class="d-none name"><code>MMODS-vignette.Rmd</code></div>
    </div>

    
    
<p>This vignette implements the second case study from <span class="citation">(Howerton et al., n.d.)</span>. We use predictions from
a real-time multi-model effort to evaluate the efficacy of a
stay-at-home intervention in a US county of approximately 100,000
individuals early in the COVID-19 pandemic (May-November 2020). In
addition to predictions of cumulative deaths from 17 distinct models, we
also retrospectively collected observed cumulative deaths over the same
period in comparable US counties that implemented a stay-at-home order
for the duration of the projection period. Details on the study can be
found in <span class="citation">(Shea et al. 2020)</span>, and raw data
is available at <a href="https://github.com/MMODS-org/Elicitation-1" class="external-link uri">https://github.com/MMODS-org/Elicitation-1</a>.</p>
<p>To start, we load a few packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for aggregation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://m-qin.github.io/CombineDistributions/" class="external-link">CombineDistributions</a></span><span class="op">)</span> </span>
<span><span class="co"># for data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="co"># for numerical integration</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pracma</span><span class="op">)</span></span>
<span><span class="co"># for speeding up aggregation calcs</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/foreach" class="external-link">foreach</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="co"># for plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span></code></pre></div>
<p>First, we load the data (both individual model projections and
post-hoc observations). These data are provided in the package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># test if directories exists locally, if not create them</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="st">"../figures"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"../figures"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="st">"../data"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"../data"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fig_path</span> <span class="op">&lt;-</span> <span class="st">"../figures/"</span></span>
<span><span class="va">data_path</span> <span class="op">&lt;-</span> <span class="st">"../data/"</span></span>
<span><span class="va">data_raw_path</span> <span class="op">&lt;-</span> <span class="st">"../data-raw/"</span> <span class="co"># contains scripts that write into data/ directory</span></span>
<span></span>
<span><span class="co"># individual projections</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">"MMODS.rda"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_raw_path</span>, <span class="st">"MMODS.R"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">MMODS</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># observations</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="st">"MMODS_obs.rda"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_raw_path</span>, <span class="st">"MMODS_obs.R"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">MMODS_obs</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">MMODS_obs</span> <span class="op">&lt;-</span> <span class="va">MMODS_obs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Population</span>, <span class="va">cumu_deaths</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>obs_num <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can plot the individual projections, sorted by median cumulative
death projection.</p>
<p><img src="MMODS-vignette_files/figure-html/plot-ind-proj-1.png" width="384"></p>
<div class="section level2">
<h2 id="aggregating-the-projections">Aggregating the projections<a class="anchor" aria-label="anchor" href="#aggregating-the-projections"></a>
</h2>
<p>We can aggregate the individual projections using either averaging
approach (LOP vs. Vincent). We will try both frameworks with all
trimming alternatives (interior vs. exterior CDF trimming).</p>
<p>First, we define a <code>data.frame</code> with all possible
aggregation methods to try. We define the averaging method (LOP
vs. Vincent), <code>method</code>, the number of values to trim,
<code>n_trim</code>, and whether trimming should be interior or
exterior, <code>int_ext</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define methods to test</span></span>
<span><span class="va">test_trim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LOP"</span>, <span class="st">"vincent"</span><span class="op">)</span>,</span>
<span>                         n_trim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span>, </span>
<span>                         int_ext <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"interior"</span>, <span class="st">"exterior"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">test_trim</span><span class="op">$</span><span class="va">trim_type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"cdf"</span>, <span class="va">test_trim</span><span class="op">$</span><span class="va">int_ext</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="co"># filter out duplicates (only trim even exterior and odd interior)</span></span>
<span><span class="va">test_trim</span> <span class="op">=</span> <span class="va">test_trim</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rm_flag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">(</span><span class="va">int_ext</span> <span class="op">==</span> <span class="st">"interior"</span> <span class="op">&amp;</span> <span class="va">n_trim</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|</span> </span>
<span>                          <span class="op">(</span><span class="va">int_ext</span> <span class="op">==</span> <span class="st">"exterior"</span> <span class="op">&amp;</span> <span class="va">n_trim</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rm_flag</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">rm_flag</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">rm_flag</span><span class="op">)</span></span></code></pre></div>
<p>Then, we implement the aggregation using each of these methods. To
aggregate a set of cdfs, we use the <code><a href="../reference/aggregate_cdfs.html">aggregate_cdfs()</a></code>
function, where <code>data</code> is a data.frame containing all
projections, <code>id_var</code> is the name of the column that should
be aggregated across, <code>method</code> is <code>"LOP"</code> or
<code>"vincent"</code>, <code>ret_quantiles</code> are the quantiles of
teh aggregate distribution to be returned, and
<code>weighting_scheme</code> and <code>n_trim</code> define the
weighting scheme.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run all possible combinations</span></span>
<span><span class="va">ret_quant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">aggs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>i<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">test_trim</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/aggregate_cdfs.html">aggregate_cdfs</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">MMODS</span>,</span>
<span>                 id_var <span class="op">=</span> <span class="st">"id"</span>, </span>
<span>                 method <span class="op">=</span> <span class="va">test_trim</span><span class="op">[</span><span class="va">i</span>,<span class="st">"method"</span><span class="op">]</span>, </span>
<span>                 ret_quantiles <span class="op">=</span> <span class="va">ret_quant</span>,</span>
<span>                 weighting_scheme <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">test_trim</span><span class="op">[</span><span class="va">i</span>,<span class="st">"n_trim"</span><span class="op">]</span><span class="op">)</span>, <span class="st">"equal"</span>, </span>
<span>                               <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">test_trim</span><span class="op">[</span><span class="va">i</span>,<span class="st">"trim_type"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                 n_trim <span class="op">=</span> <span class="va">test_trim</span><span class="op">[</span><span class="va">i</span>,<span class="st">"n_trim"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">aggs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">aggs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a column for each aggregation method specification</span></span>
<span><span class="va">aggs</span> <span class="op">&lt;-</span> <span class="va">aggs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">test_trim</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ret_quant</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">test_trim</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">test_trim</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># change NA n_trim (mean) to 0</span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_trim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">n_trim</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">n_trim</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can plot each of the aggregates.</p>
<p><img src="MMODS-vignette_files/figure-html/plot-aggs-1.png" width="384"></p>
</div>
<div class="section level2">
<h2 id="evaluating-the-predictions">Evaluating the predictions<a class="anchor" aria-label="anchor" href="#evaluating-the-predictions"></a>
</h2>
<p>Here we evaluate the performance of each aggregate distribution
against the distribution of observed values.</p>
<p>Before evaluating performance, let’s do a quick check on our
observations. Although population size is restricted to 90,000-110,000
individuals, it is not constant for all counties. So, to make sure
population size isn’t confounding the observed number of cumulative
deaths, we double check the correlation between the two.</p>
<p><img src="MMODS-vignette_files/figure-html/obs-corr-1.png" width="384"></p>
<p>To evaluate performance, we use four metrics:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Log score</strong>, defined as <span class="math display">\[log Score=log⁡(f(x))f\]</span> where <span class="math inline">\(N\)</span> is the number of observations, <span class="math inline">\(f(i)\)</span> is the predicted probability density
function and <span class="math inline">\(x\)</span> is the observed
value. Lower scores indicate better performance.</p></li>
<li><p><strong>Continuous rank probability score (CRPS)</strong>,
defined as<br><span class="math display">\[CRPS(F,x)= \int_{-\infty}^\infty
(F(y)-1\{y≥x\})^2 dy = \int_{-\infty}^xF(y)^2 dy+
\int_x^{\infty}(F(y)-1)^2 dy\]</span> where <span class="math inline">\(1\{y≥x\}=1\)</span> if <span class="math inline">\(y≥x\)</span> and 0 otherwise. Distributions with
the lowest CRPS values will be both calibrated (i.e., the observed value
will fall in the center of the distribution) and sharp (i.e.,
concentrated around the observed value). Because the distributions being
evaluated are defined empirically (rather than by a particular
functional form), analytical evaluation of the CRPS is not possible.
Instead, we approximate CRPS using <span class="math display">\[CRPS(F,x)= E_F |X-x|-\frac{1}{2} E_F
|X-X'|\]</span> where <span class="math inline">\(E_F |X|\)</span>
represents the expectation of the absolute value of <span class="math inline">\(X\)</span> with <span class="math inline">\(X ~
F(U1)\)</span> and <span class="math inline">\(X' ~ F(U2)\)</span>
for <span class="math inline">\(U1, U2 \sim Uniform(0,1)\)</span>. We
use 1,000 random uniform draws for each CRPS approximation.</p></li>
<li><p><strong>90% interval coverage</strong> is defined as <span class="math display">\[Coverage: 90\% = \frac{|C_{90} |}{N} \text{
}  for \text{ } C_{90}= {x∶F^{-1} (0.05)≤x ≤ F^{-1}(0.95)}\]</span>
where <span class="math inline">\(x\)</span> is the observed value and
<span class="math inline">\(F^{-1}\)</span> is the predicted quantile
function. We denote the cardinality (i.e., size) of some set, <span class="math inline">\(A\)</span>, with <span class="math inline">\(|A|\)</span>.</p></li>
<li><p><strong>Kullback-Leibler information criterion (KLIC)</strong> is
defined as</p></li>
</ol>
<p><span class="math display">\[KLIC = \int_{-\infty}^\infty  [log(o(y))
- log(f(y))]o(y) dy\]</span> where <span class="math inline">\(o(y)\)</span> is the probability distribution of
observations and <span class="math inline">\(f(y)\)</span> is the
predicted probability density function. We approximate this integral
numerically using the trapezoid rule. If distributions are not defined
for a particular observation, we assume the values of <span class="math inline">\(o\)</span> or <span class="math inline">\(f\)</span> are very close to 0, specifically <span class="math inline">\(o(y)=10^{-5}\)</span> and <span class="math inline">\(f(y)=10^{-5}\)</span>.</p>
<p>More details on each score can be found in Electronic Supplementary
Material 1.4 of <span class="citation">(Howerton et al.,
n.d.)</span>.</p>
<p>Here, we define a function to implement each of these metrics.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CRPS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">q</span>,<span class="va">v</span>,<span class="va">o</span>,<span class="va">size</span><span class="op">=</span><span class="fl">1000</span>, <span class="va">rule</span><span class="op">=</span><span class="fl">2</span>, <span class="va">ties</span><span class="op">=</span><span class="st">"ordered"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">101</span><span class="op">)</span> <span class="co"># set seed so using same uniform draws each time</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span><span class="va">q</span>,<span class="va">v</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span>,rule<span class="op">=</span><span class="va">rule</span>, ties<span class="op">=</span><span class="va">ties</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">y</span><span class="op">-</span><span class="va">o</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> </span>
<span>           <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">y</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span><span class="va">q</span>,<span class="va">v</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span>,rule<span class="op">=</span><span class="va">rule</span>, ties<span class="op">=</span><span class="va">ties</span><span class="op">)</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">log_score</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dens_x</span>,<span class="va">dens_y</span>,<span class="va">o</span>,<span class="va">rule</span><span class="op">=</span><span class="fl">2</span>, <span class="va">ties</span><span class="op">=</span><span class="st">"ordered"</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#approx_pdf &lt;- density(approx(q, v, runif(size))$y)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span><span class="va">dens_x</span>, <span class="va">dens_y</span>, <span class="va">o</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, rule <span class="op">=</span> <span class="va">rule</span>, ties <span class="op">=</span> <span class="va">ties</span><span class="op">)</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">KLIC</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dens_x</span>, <span class="va">dens_y</span>, <span class="va">obs</span>, <span class="va">zer</span> <span class="op">=</span> <span class="fl">1E-5</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">obs_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span></span>
<span>  <span class="va">rng</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">obs_dist</span><span class="op">$</span><span class="va">x</span>, <span class="va">dens_x</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">obs_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span><span class="va">obs_dist</span><span class="op">$</span><span class="va">x</span>, <span class="va">obs_dist</span><span class="op">$</span><span class="va">y</span>, <span class="va">rng</span>, yleft <span class="op">=</span> <span class="va">zer</span>, yright <span class="op">=</span> <span class="va">zer</span><span class="op">)</span></span>
<span>  <span class="va">tst_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span><span class="va">dens_x</span>, <span class="va">dens_y</span>, <span class="va">rng</span>, yleft <span class="op">=</span> <span class="va">zer</span>, yright <span class="op">=</span> <span class="va">zer</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/pracma/man/trapz.html" class="external-link">trapz</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">obs_dist</span><span class="op">$</span><span class="va">y</span><span class="op">/</span><span class="va">tst_dist</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="op">*</span> <span class="va">obs_dist</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">cov</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">q</span>, <span class="va">v</span>, <span class="va">obs</span>, <span class="va">cov_level</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">lwr</span> <span class="op">&lt;-</span> <span class="va">v</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">q</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">cov_level</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">0.0001</span><span class="op">]</span></span>
<span>  <span class="va">upr</span> <span class="op">&lt;-</span> <span class="va">v</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">q</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">cov_level</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.0001</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">obs</span> <span class="op">&lt;</span> <span class="va">upr</span> <span class="op">&amp;</span> <span class="va">obs</span> <span class="op">&gt;=</span> <span class="va">lwr</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now, apply each function to all aggregate distributions.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># merge the aggregates and observations</span></span>
<span><span class="va">scores_CRPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span><span class="va">aggs</span>,<span class="va">MMODS_obs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">cumu_deaths</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>obs_num <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">MMODS_obs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># set as data.table</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">scores_CRPS</span><span class="op">)</span></span>
<span><span class="co"># get CRPS score</span></span>
<span><span class="va">scores_CRPS</span> <span class="op">&lt;-</span> <span class="va">scores_CRPS</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>CRPS <span class="op">=</span> <span class="fu">CRPS</span><span class="op">(</span><span class="va">quantile</span>,<span class="va">value</span>,<span class="va">cumu_deaths</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                   by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">method</span>, <span class="va">n_trim</span>, <span class="va">int_ext</span>, <span class="va">obs_num</span>, <span class="va">cumu_deaths</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># get log score</span></span>
<span><span class="va">n_samp</span> <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="va">pdfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">aggs</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>samp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span><span class="va">quantile</span>, <span class="va">value</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_samp</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, </span>
<span>             by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">method</span>, <span class="va">n_trim</span>, <span class="va">int_ext</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">pdfs</span> <span class="op">&lt;-</span> <span class="va">pdfs</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>dens_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">samp</span><span class="op">)</span><span class="op">$</span><span class="va">x</span>, </span>
<span>                 dens_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">samp</span><span class="op">)</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, </span>
<span>             by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">method</span>, <span class="va">n_trim</span>, <span class="va">int_ext</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">scores_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span><span class="va">pdfs</span>, <span class="va">MMODS_obs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">cumu_deaths</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>obs_num <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">MMODS_obs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">scores_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">scores_log</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>logS <span class="op">=</span> <span class="fu">log_score</span><span class="op">(</span><span class="va">dens_x</span>, <span class="va">dens_y</span>, <span class="va">cumu_deaths</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                   by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">method</span>, <span class="va">n_trim</span>, <span class="va">int_ext</span>, <span class="va">obs_num</span>, <span class="va">cumu_deaths</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># kullback-leibler</span></span>
<span><span class="va">scores_klic</span> <span class="op">&lt;-</span> <span class="va">pdfs</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>klic <span class="op">=</span> <span class="fu">KLIC</span><span class="op">(</span><span class="va">dens_x</span>, <span class="va">dens_y</span>, <span class="va">MMODS_obs</span><span class="op">$</span><span class="va">cumu_deaths</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">method</span>, <span class="va">n_trim</span>, <span class="va">int_ext</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span><span class="co"># coverage</span></span>
<span><span class="va">scores_cov</span> <span class="op">&lt;-</span> <span class="va">aggs</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>cov90 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">quantile</span>, <span class="va">value</span>, <span class="va">MMODS_obs</span><span class="op">$</span><span class="va">cumu_deaths</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                   by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">method</span>, <span class="va">n_trim</span>, <span class="va">int_ext</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># create one df for all scores</span></span>
<span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">scores_CRPS</span>, <span class="va">scores_log</span><span class="op">)</span></span>
<span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="va">scores</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>avg_crps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">CRPS</span><span class="op">)</span>, </span>
<span>                     avg_logS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">logS</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                 by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">method</span>, <span class="va">n_trim</span>, <span class="va">int_ext</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">scores</span>, <span class="va">scores_klic</span><span class="op">)</span></span>
<span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">scores</span>, <span class="va">scores_cov</span><span class="op">)</span></span></code></pre></div>
<p>We can plot the outcomes of this performance analysis.</p>
<p><img src="MMODS-vignette_files/figure-html/plot-scores-1.png" width="384"></p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-EAH-ms" class="csl-entry">
Howerton, Emily, Michael C. Runge, Tiffany L. Bogich, Rebecca K.
Borchering, Hidetoshi Inamine, Justin Lessler, Luke C. Mullany, et al.
n.d. <span>“Context-Dependent Representation of Within- and
Between-Model Uncertainty: Aggregating Probabilistic Predictions in
Infectious Disease Epidemiology.”</span> <em>In Prep</em>.
</div>
<div id="ref-shea_covid-19_2020" class="csl-entry">
Shea, Katriona, Rebecca K. Borchering, William J. M. Probert, Emily
Howerton, Tiffany L. Bogich, Shouli Li, Willem G. van Panhuis, et al.
2020. <span>“<span>COVID</span>-19 Reopening Strategies at the County
Level in the Face of Uncertainty: <span>Multiple</span>
<span>Models</span> for <span>Outbreak</span> <span>Decision</span>
<span>Support</span>.”</span> <em>medRxiv</em>, November,
2020.11.03.20225409. <a href="https://doi.org/10.1101/2020.11.03.20225409" class="external-link">https://doi.org/10.1101/2020.11.03.20225409</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Emily Howerton.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
